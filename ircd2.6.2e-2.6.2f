From avalon@coombs.anu.edu.au Thu Nov 21 10:53:30 1991
Newsgroups: eff.mail.irc-operlist
From: avalon@coombs.anu.edu.au (Darren Reed)
Subject: irritating and icky bug.
Organization: EFF mail-news gateway
Distribution: eff
Date: 22 Nov 91 12:11:31 GMT

The problem with mode failing in 2.6.2d/e was found :-)
It was not a very entertaining bug :-(
The mode ("+o") string wasnt getting terminated by a null.
Patch follows. Sorry.
Thanks to Wumpus for helping to find this one.

-avalon

*** ircd/channel.c.orig	Fri Nov 22 01:03:55 1991
--- ircd/channel.c	Thu Nov 21 16:28:47 1991
***************
*** 1079,1085
  
  	cp = modebuf;
  	send = count = 0;
- 	*cp = '\0';
  	*cp++ = '+';
  	*parabuf = '\0';
  	for (addops = chptr->members; addops; addops = addops->next)

--- 1079,1084 -----
  
  	cp = modebuf;
  	send = count = 0;
  	*cp++ = '+';
  	*cp = '\0';
  	*parabuf = '\0';
***************
*** 1081,1086
  	send = count = 0;
  	*cp = '\0';
  	*cp++ = '+';
  	*parabuf = '\0';
  	for (addops = chptr->members; addops; addops = addops->next)
  	    {

--- 1080,1086 -----
  	cp = modebuf;
  	send = count = 0;
  	*cp++ = '+';
+ 	*cp = '\0';
  	*parabuf = '\0';
  
  	for (addops = chptr->members; addops; addops = addops->next)
***************
*** 1082,1087
  	*cp = '\0';
  	*cp++ = '+';
  	*parabuf = '\0';
  	for (addops = chptr->members; addops; addops = addops->next)
  	    {
  		if (!IsChanOp((aClient *)addops->value, chptr))

--- 1082,1088 -----
  	*cp++ = '+';
  	*cp = '\0';
  	*parabuf = '\0';
+ 
  	for (addops = chptr->members; addops; addops = addops->next)
  	    {
  		if (!IsChanOp((aClient *)addops->value, chptr))
***************
*** 1091,1096
  		    MODEBUFLEN)
  		    {
  			*cp++ = 'o';
  			strcat(parabuf, ((aClient *)(addops->value))->name);
  			strcat(parabuf, " ");
  			count++;

--- 1092,1098 -----
  		    MODEBUFLEN)
  		    {
  			*cp++ = 'o';
+ 			*cp = '\0';
  			strcat(parabuf, ((aClient *)(addops->value))->name);
  			strcat(parabuf, " ");
  			count++;
***************
*** 1106,1112
  			send = count = 0;
  			cp = modebuf;
  			*parabuf = '\0';
- 			*cp = '\0';
  			*cp++ = '+';
  		    }
  	    }

--- 1108,1113 -----
  			send = count = 0;
  			cp = modebuf;
  			*parabuf = '\0';
  			*cp++ = '+';
  			*cp = '\0';
  		    }
***************
*** 1108,1113
  			*parabuf = '\0';
  			*cp = '\0';
  			*cp++ = '+';
  		    }
  	    }
  	if (*parabuf)

--- 1109,1115 -----
  			cp = modebuf;
  			*parabuf = '\0';
  			*cp++ = '+';
+ 			*cp = '\0';
  		    }
  	    }
  	if (*parabuf)
***************
*** 1114,1117
  		sendto_one(cptr, ":%s MODE %s %s %s",
  			   me.name, chptr->chname, modebuf, parabuf);
      }
- 

--- 1116,1118 -----
  		sendto_one(cptr, ":%s MODE %s %s %s",
  			   me.name, chptr->chname, modebuf, parabuf);
      }
*** include/patchlevel.h.orig	Fri Nov 22 01:05:16 1991
--- include/patchlevel.h	Thu Nov 21 16:29:07 1991
***************
*** 28,31
   *
   */
  
! #define PATCHLEVEL "2.6.2e"

--- 28,31 -----
   *
   */
  
! #define PATCHLEVEL "2.6.2f"

