
            Installing IRC - The Internet Relay Chat Program


Overview of this document:

  1) The config.h file
  2) Editing the Makefile
  3) Compiling IRC
  4) The irc.conf file


1) Edit the "config.h" file and make changes to the various #DEFINE's:
   
   a) Define what type of UNIX your machine uses. IRC currently
      supports, BSD42, BSD43, HPUX, APOLLO.  To select the one you want, 
      replace the "0" with a "1" next to the choice you want.  All the other
      UNIX #defines should be set to "0".

   b) Define DOMAINNAME, if your systems supports the "getdomainname()" system
      call.  You can check this by typing "domainname" at the UNIX prompt and
      seeing if anything appears.  IRC will attempt to add your UNIX Internet
      System Domain to your hostname if it is not currently present on your
      "hostname()".  You should define this if you do support getdomainame(). 
      
   c) Define TTYON if you want to see the ircd debugging information as
      the daemon is running.  Normally this function will be undefined as
      ircd produces a considerable amount of output. 


   d) Define MYNAME to be the directory path to ircd.  This is usually
      /usr/local/bin/ircd, unless you don't have installation permission
      there. 

   e) Define CONFIGFILE to be the directory path to the "irc.conf" file.
      This path is usually /usr/local/lib/irc.conf. The format of this file 
      will be discussed later.

   f) The PORTNUM #define sets the alters the Internet socket port for IRC.  
      IRC will use this port to accept connections from other irc servers
      and clients.  The current addresses used for irc are 6667 and 
      infrequently 6666.  Note that if you change these values, all other
      servers that connect to yours will have to know your port setting. In
      order to avoid the problems of distributing this information, it is
      recommended that you leave the port at 6667.

      Although these are not OFFICIALLY reserved for IRC, they are the ports
      we have unofficially claimed for the program.  


   g) The LOGFILE #define should be set to "/dev/null" unless you plan to 
      debug the program.  Note that the logfile grows very quickly.


      --------------------------------------------------------------------
      The remaining #defines should not be altered unless you are sure that
      you know what you are doing.  If you are planning to change them,
      it is recommended that you contact irclist first.

   h) Define TIMESEC to be the amount of IDLE time you will allow your server
      to WAIT before attempting to request status of your neighboring servers.
      After TIMESEC seconds have passed and no activity has occured on IRC,
      IRC will enter a routine where it will send a PING message to all of
      the servers connected to your IRCD.  It will send one PING to every
      server and will expect the other servers to send a PONG message back
      saying that they are "okay and functioning".  The program has a built
      in time stamp that tells IRC the last time that something was received
      from a curtain server.  PINGFREQUENCY refers to the amount of time
      you will allow server connections to be IDLE.  After this IDLE time
      has expired (IE the server has been IDLE for PINGFREQUENCY seconds)
      the program will PING that particular server and will expect a PONG
      message response from that server.  If no reply to a PING message is
      received in 2 * PINGFREQUENCY seconds the connection will be closed,
      and reconnection attempts can be made by your IRCD or the remote IRCD
      depending upon which server connects to whom.

   i) Define PINGFREQUENCY - (see "h" above)

   j) Define CONNECTFREQUENCY - will define the number of SECONDS for your
      server to wait before it attempts reconnection at it's neighboring
      IRC hosts.  The default value is 20 minutes (1200 seconds) and that
      is generally pretty good for RECONNECTION time.  You should probably
      not change this Define.

   k) Define WRITEDELAY affects the UNIX Socket command WRITE() which is used
      to write socket information to the IRCD socket.. and beyond!  Sometimes
      a socket can become very crowded (if say 10-20 people were using IRC)
      and it will lock up the users keyboard until it can get a return value
      from the socket, which tells IRC some information about the WRITE() call.
      To BREAK this lockup, you need to specify the number of seconds you'll
      allow the SOCKET to stay locked up before you'll BREAK the lock - this
      typically is 15 seconds and that is a pretty good number for it.  I
      recommend you leave it DEFAULT value.



2) Edit the Makefile Makefile:

   The only change to the Makefile should be the setting of the SYS variable.
   Since SySV is currently unsupported, the variable should remain as 'bsd',
   and this step is not required.


3) Configure and compile the code.

   Type "make config".  This will install the OS-dependent files.

   Type "make". This will compile the server, the client, and the services.
   At the end of this step, the server directory will contain 'ircd',
   and the client directory will contain 'irc'.

  
   Note that the ircd executable will have the  SETUID bit set on so that
   other besides you can boot the server if it goes down and you aren't around
   to boot it yourself.  The SETUID bit allows others to run the server,
   but it will run under your UID so that you will be able to kill it later.

   The SETUID bit also allows ircd to read the "irc.conf" file, because it
   would be accessed as USER instead of GROUP or OTHER.  You should ensure
   that "irc.conf" is not readable by others, since it contains the operator
   password.


4) The irc.conf file.

   After installing the ircd and irc programs, edit the irc.conf file
   as per the instructions in this section and  install it in the 
   location you specified in the config.h file.  There is a sample
   conf file called example.conf in the /doc directory.

   Appendix A describes the differences between IP addresses and host
   names.  If you are unfamiliar with this, you should probably scan 
   through it before proceeding.


   The irc.conf file contains various records that specify configuration
   options.  The record types are as follows:
   
   1.  Server connections   	(C,N)
   2.  Machine information	(M)
   3.  Client connections	(I)
   4.  Default local server	(U)
   5.  Operator priviliges	(O)
   6.  Administrative info	(A)
   7.  Excluded accounts	(K)

   
   1. SERVER CONNECTIONS:  How to connect to other servers
			   How other servers can connect to you

   Now you must decide WHICH hosts you want to connect to and WHAT ORDER you
   want to connect to them in.  For my example let us assume I am on the
   machine "tolsun.oulu.fi" and I want to connect to irc daemons on 3 other
   machines:

         "naakka.tut.fi"           - Primary Connection
         "orion.cair.du.edu"       - Secondary Connection
         "hal.oce.orst.edu"        - Tertiary Connection

   And I prefer to connect to them in that order, meaning I first want to
   try connecting to "naakka.tut.fi", then to "orion.cair.du.edu", and
   finally to "hal.oce.orst.edu".  So if "naakka.tut.fi" is down or
   unreachable, the program will try to connect to "orion".
   If orion is down it will try to connect to "hal" and so forth.
   PLEASE limit the number of hosts you will attempt to connect to down to 3.
   We are trying to limit the amount of Network Traffic IRC creates.

   The format for the CONNECT entry in the "irc.conf" is:

       C:<TARGET Host Addr>:<Password>:<TARGET Host NAME>:<TARGET Host PORT>
Field: 1        2              3                4               5

   for example:
   
    C:orion.cair.du.edu:passwd:orion.cair.du.edu:6667 

          - or -

    C:130.253.1.15:passwd:orion.cair.du.edu:6667

    Explanation:

    Each field is separated with a ":" charcter:

    Field 1: Field 1 tells the IRC program which option is being configured.
             "C" corresponds to a server Connect option.

    Field 2: Specifies the host name or IP address of the machine to connect
	     to.  We recommend that you use the numeric IP address in 
	     this field.

    Field 3: The password of the other host.  Some hosts require passwords
             before you can connect to them.  If no password is required
	     this field can be left blank.

    Field 4: The full hostname of the target machine. This is the name that 
	     the TARGET server will identify itself with when you connect 
	     to it.  If you were connecting to orion you would receive
	     "orion.cair.du.edu" and that is what you should place in 
	     this field.
  
    Field 5: The INTERNET Port that you want to connect to on the TARGET 
	     machine. Most of the time this will be set to "6667".  
             If this field is left blank, then no connections will 
             be attempted to the TARGET host, and your host will accept
             connections from the TARGET host instead.

   Some examples:

            C:naakka.tut.fi::naakka.tut.fi:6667
 
            This reads: Connect to host "naakka.tut.fi", with no password
            and expect this server to identify itself to you as "naakka.tu.fi".
            Your machine will connect to this host at PORT 6667.

            C:130.253.1.15:Jeff:orion.cair.du.edu:6667

            This reads: Connect to a host at adress "130.253.1.15", using a
            password of "Jeff".  The TARGET server should identify
            itself as "orion.cair.du.edu".  *YOU* will connect at Internet
            Port 6667 on this host.

            C:orion.cair.du.edu::orion.cair.du.edu
                                                                               
            This reads: do not attempt to connect to "orion.cair.du.edu", 
			but if "orion.cair.du.edu" requests a connection,
			allow it to connect.

   Now back to our original problem, we wanted OUR server CONNECT to 3
   hosts,  "naakka.tut.fi", "orion.cair.du.edu" and "hal.oce.orst.edu" in
   that order.  So as we enter these entries into the file they must be
   done in REVERSE order of how we could want to connect to them.
   Note that the reversal is a bug, and should be fixed in future releases.
   Here's how it would look if we connected "naakka.tut.fi" first:

      C:hal.oce.orst.edu::hal.oce.orst.edu:6667
      C:orion.cair.du.edu::orion.cair.du.edu:6667
      C:naakka.tut.fi::naakka.tut.fi:6667

   Ircd will attempt a connection to naakka first, then to orion, and 
   finally to hal.


   Reciprocal entries:

   Each "C" entry requires a corresponding 'N' entry that specifies
   connection priviliges to other hosts.  The 'N' entry contains
   the password, if any, that you require other hosts to have before
   they can connect to you.  These entries are of the same format as
   the "C" entries.

    
   Let us assume that "orion.cair.du.edu" connects to your server
   and you want to place password authorization authorization on orion.
   The "N" entry would be:
   
   make your "N" entry for Orion to be:

          N:orion.cair.du.edu:golden:orion.cair.du.edu
  
   This line says: expect a connection from host "orion.cair.du.edu",
   and expect a login password of "golden" 
   and expect the host to identify itself as "orion.cair.du.edu".
     
          N:130.253.1.15::orion.cair.du.edu

   This line says: expect a Connection from host "130.253.1.15", and 
   don't expect login password.  The connecting host should identify itself
   as "orion.cair.du.edu". 

   Note: unlike "C" entries, port numbers are not required for "N" entries.


   Wildcards: 

   Note that wildcards are allowd in hostnames or IP addresses. For 
   instance, to allow all hosts in Finland to connect to tolsun,
   you could specify

   C:*.fi::*.fi
   N:*.fi::*.fi




   2. MACHINE INFORMATION
                            

   IRC needs to know a few things about your UNIX site, and the "M" command
   specifies this information for IRC.  The fomat of this command is:

           M:<YOUR Host NAME>:xxx:<Geographic Location>:<Internet Port>
   Field:  1         2         3           4                 5

   Explanation:

      Field 1: "M" specifies a Machine description line

      Field 2: The name of YOUR host adding any Internet DOMAINNAME that 
               might also be present.  

      Field 3: -- NOT USED --: Set to Value NULL (No spaces at ALL!).
    
      Field 4: Geographic Location is used to say WHERE YOUR SEVRER is,
               and gives people in other parts of the world a good
               idea of where you are!  If your server is in the USA, it is
               usually best to say: <CITY> <STATE>, USA.  Like for Denver
               I say: "Denver Colorado, USA".  Finnish sites (like
               tolsun.oulu.fi generally say something like "Oulu, Finland".
 
      Field 5: The Internet port your server will use.  Should be set to
	       the same value as in the config.h file.


      Example:
                M:tolsun.oulu.fi::Oulu, Finland:6667

                This line reads: My Host's name is "tolsun.oulu.fi" and
                my site is located in "Oulu, Finland".  My ircd will use
		Internet Port 6667.


                M:orion.cair.du.edu::Denver Colorado, USA:6667

                This line reads: My Hosts name is "orion.cair.du.edu"
                and my site is located in "Denver
                Colorado, USA".  I have defined Internet Port
                number "6667" to be used as my IRCD Socket Port.



   3. CLIENT CONNECTIONS -   How to let clients connect to your IRCD.

   A client is a program that connects to the ircd daemon (ircd).  Currently
   there are clients written in C and in GNU Emacs Lisp.  The "irc"
   program is the C client.  Each person that talks via IRC is running
   their own client.

   The irc.conf files contains entries that specify which clients are allowed
   to connect to your irc daemon.  Obviously you want to allow your cwn
   machine's clients to connect.  You may want to allow clients from 
   other sites to connect.  These remote clients will use your server
   as a connection point.  All messages sent by these clients will pass
   through your machine.

   The format of this entry in the conf file is:

            I:<TARGET Host Addr>:<Password>:<TARGET Hosts NAME>:<Internet Port>
      Field:1         2               3             4                5


      For example, if you were installing IRC on tolsun.oulu.fi and you wanted
      to allow examples sake let us assume you were making this file for TOLSUN
      and you wanted to let your own clients to connect to your server,
      you would add this entry to the file:

          I:128.214.5.6::tolsun.oulu.fi

      If you wanted to let remove clients connect, you could add the
      following lines:

      I:*.du.edu::*.du.edu

      Allow any clients from machines whose names end in "du.edu" to connect
      with no password.

      I:128.193.64.132::hal.oce.orst.edu

      Allow clients from a machine with that IP number and the name 
      hal.oce.orst.edu to connect.

      I:naakka.tut.fi:secret:naakka.tu.fi

      Allow clients from naakka.tut.fi to connect with the password 'secret'.



   4. DEFAULT HOSTS (for local clients)

      This defines the default connection for the ircd client.  If you are
      running an ircd server on the same machine, you will want to define
      this command to connect to your own host.  If your site is not running
      a server then this command should contain the TARGET host's connection
      information and password (if any).  The format for this command is:

             U:<TARGET Host addr>:<Password>:<TARGET Host NAME>:<Internet Port>
      Field: 1         2              3                4            5
   

      For example:

           U:tolsun.oulu.fi::tolsun.oulu.fi:6667
           U:128.214.5.6::tolsun.oulu.fi:6667
           U:tolsun.oulu.fi::tolsun.oulu.fi

      If the port number is omitted, irc will default to using 6667.
 



  5. OPERATOR Priviliges:  How to become the IRC administrator on your site

   To become an IRC Administrator, IRC must know who is authorized to become
   an operator and what their "Nickname" and "Password" is.  To add this
   information, EDIT your "irc.conf" file and add the following command
   line to it:

          O:<TARGET Host NAME>:<password>:<nickname>
  Field:  1          2             3          4

  Explanation:
 
     Field 1: Speficies Operator record.

 
     Field 2: Tells IRC which host you have the privileges FROM.  This
              means that you should be logged into this host when you
              ask for the priviliges.  If you specify "tolsun.oulu.fi"
              then IRC will expect your CLIENT to be connected at 
              "tolsun.oulu.fi" - when you ask for OPERATOR privileges
              from "tolsun.oulu.fi".  You cannot be logged in at any
              other host and be able to use your OPERATOR privileges
              at tolsun, only when you are connected at TOLSUN will this
              work - this is a safeguard against unauthorized sites.


     Field 3: If your AUTHORIZATION Password - this is the password that 
              let's IRC know you are who you say you are!  Never tell anyone
              your password and always keep the "irc.conf" file protected
              from all of the other users.
 
     Field 4: The Nickname you usually go by - but you can make this what
              you want.  It is better to make this a NICKNAME that no one
              else knows, but anything will do.  I usually use my own
              loginname.

  Example:
              O:orion.cair.du.edu:pyunxc:Jeff

              There is an OPERATOR at "orion.cair.du.edu" that can get
              Operator priviliges if he specifies a password of "pyunxc"
              and uses a NICKNAME of "Jeff".



  6. ADMINISTRATIVE INFORMATION

  The "A" command is used for administrative information about a site.
  The e-mail address of the person running the server should be included
  here in case problems arise.

  
            A:<Your Name/Location>:<Your Electronic Mailing Addr>:<other> 
  Field:    1        2                    3                         4

  Explanation:

       Field 1: "A" specifies an Admin record.


       Field 2: Use this field to say tell your FULL NAME and where in the 
                world your machine is.  Be sure to add your City, 
		State/Province and Country.


       Field 3: Use this field to specify your Electronic Mailing Address
                preferably your Internet Mailing Address.  If you have
                a UUCP or ARAPnet address - please add that as well.  Be
                sure to add any extra DOMAIN information that is needed,
                for example "mail jtrim@orion" probably won't work as a 
                mail address to me if you happen to be in Alaska.  But 
                "mail jtrim@orion.cair.du.edu" would work because you 
                know that "orion" is part of the DOMAIN "cair.du.edu". 
                So be sure to add your DOMAINNAMES to your mailing addresses.

       Field 4: Is really an OTHER field - you can add what you want here,
                

  Examples:

A:Jeff Trim -  Denver Colorado, USA:INET jtrim@orion.cair.du.edu UUCP {hao, isi
s}!udenva!jtrim:Terve! Hei! Heippa!  Have you said hello in Finnish today?
 ;)

  Would look like this when printed out with the /admin command:

      Jeff Trim -  Denver Colorado, USA
      INET jtrim@orion.cair.du.edu   UUCP {hao, isis}!udenva!jtrim
      Terve! Hei! Heippa!  Have you said hello in Finnish today? ;)
 
 
  Note that the A record cannot be split across multiple lines; it will 
  typically be longer than 80 characters and will therefore wrap around
  the screen.


  7. REMOVING A USER FROM IRC  Remove an errant user from IRC on your site.

  Obviously it is hoped that you wouldn't have to use this command.
  Unfortunately sometimes a user can become unmanageable and this is your
  only recourse - the KILL USER command.  THIS COMMAND ONLY AFFECTS YOUR
  SERVER - If this user can connect to another SERVER somewhere else in
  the IRC-Network then you would have to talk to the administrator on that
  site to disable his access from that IRCD Server as well.

  The format of this command is:

         K:<Host Name>::<User>
  Field: 1     2      3   4

  Explanation:

       Field 1:  "K" tells the IRCD that you are making a KILL USER command
                 entry.

       Field 2:  In this field you specify the Hostname that the user is 
                 connecting from.  If you user you wanted REMOVED connects
                 to IRC from "orion.cair.du.edu" then you would want to enter
                 "orion.cair.du.edu".  If you want to REMOVE ALL HOSTS
                 access you can use '*' (Wild Card notation) and no matter
                 what host the USERNAME (specified in Field 4) connects from
                 s/he will be denied access.

       Field 3:  ** NOT USED ** -- leave NULL (no spaces)
    
       Field 4:  The USERNAME of the user you want removed from IRC.  For
                 example 'root'.

   
   Some Examples:
                   K:orion.cair.du.edu::jtrim
 
               If user 'jtrim' connects to IRC from host "orion.cair.du.edu"
               then IMMEDIATELY REMOVE HIM from my IRCD.

                   K:*.cair.du.edu::root

               If user 'root' connects to IRC from any host that has the 
               suffix "cair.du.edu" - then IMMEDIATELY REMOVE THEM from
               my IRCD.

                   K:*::vijay

               This line reads "I don't care WHAT HOST user 'vijay' is on,
               I will NEVER allow username 'vijay' to login to my IRCD.




Appendix A: Difference between IP addresses and hostnames


   There are 2 different types of INETERNET addresses, NAME addresses and
   NUMERIC addresses.  NAME addresses look like ENGLISH words (and indeed
   they are ENGLISH words that refer to a given host).  A NAME address looks
   like "tolsun.oulu.fi" - and that particular address refers to the machine 
   named TOLSUN in Finland.  It is a UNIQUE address because no other machine in
   the world has its NAME address the same as "tolsun.oulu.fi".  Anytime
   you say "telnet tolsun.oulu.fi" - you would always connect to TOLSUN in
   Finland.  NUMERIC addresses refer to those addresses that are made up of
   NUMBERS for example "128.214.5.6" is the NUMERIC address for TOLSUN.  This
   address is also UNIQUE in that no other machine in the world will be use 
   those NUMERIC numbers.  The NUMERIC address is usually more reliable than
   the NAME address because not all sites can recognize and translate the
   NAME address into it's numeric counterpart.  NUMERIC always seems to work
   best, but use a NAME address when you can because it is easier to tell
   what host you are connected to.


   Every Unix machine has a file called "/etc/hosts" on it.  This file 
   contains NAME and NUMERIC addresses.  When you supply IRC with a NAME 
   address it will at first try to find it in /etc/hosts, and then (if it's 
   really smart), use the local Domain Name Server (DNS) to find the NUMERIC
   address for the host you want to connect to.  Thus if you plan to use NAME
   addresses keep in mind that on SOME sites the entry for the TARGET machine
   must be found in /etc/hosts or the NAME address will fail.  A typical 
   entry in /etc/hosts looks like this:

   130.253.1.15    orion.cair.du.edu orion.du.edu orion    # BSD 4.3

   This particular example is the Host ORION at the University of Denver. 
   Notice that on the far left is the NUMERIC Address for orion.  The
   next few ENGLISH words are the NAME addresses that can be used for orion,
   "orion.cair.du.edu", "orion.du.edu", "orion".  ALL of these NAME addresses
   will return the NUMERIC address "130.253.1.15" which IRC will use to
   connect to the TARGET UNIX. (when I say TARGET UNIX I am refering to the
   UNIX you want to connect to for IRC). Any futher questions about /etc/hosts 
   should be directed to "man hosts".



Appendix B: Enabling Summon Messages

   +-----------------------------------------------------------------------+
   |            E N A B L I N G    / S U M M O N    M E S S A G E S        |
   +-----------------------------------------------------------------------+

   *NOTE* You must have ROOT or special access to the GROUP tty ('/dev')
   to do this.  It is IMPORTANT that you do enable this option if at all
   possible!!!   The /SUMMON command is pretty important to your users
   as it allows them to be SUMMONED to IRC by other users inside of the
   IRC program.

   The "IRCD" program also needs access to the GROUP of '/dev'.   This
   directory is where user TTY's are stored (as UNIX treats each Terminal
   as a FILE! (which is a bit uncommon - but interesting!))   IRCD needs
   GROUP ACCESS to /dev so that users can be SUMMONED to the program
   by others users that are *in* the program.  This allows people from
   other Universities around the world to SUMMON your users to IRC so that
   they can chat with them.  Berkeley, SUN, HP-UX and most of the newer
   versions of UNIX check to see if a USER is accepting MESSAGES via the
   GROUP access rights on their TTY listing in the /dev directory.
   For example an entry in '/dev' looks like this:

  (Unix Path on BSD 4.3 UNIX is:  /dev/ttyp0)

        crw------- 1 jtrim     20,     0 Apr 29 10:35 ttyp0

   You will note that 'jtrim' OWNS this terminal and can READ/WRITE to this
   terminal as well (which makes sense because I am ENTERING DATA and
   RECEIVEING DATA back from the UNIX).  I logged into this particular
   UNIX on "April 29th" at "10:35am" and my TTY is "ttyp0".  But further
   of *note* is that I do not have my MESSAGES ON! (mesg n)  -- This is
   how my terminal would look with MESSAGES ON (mesg y):

        crw--w---- 1 jtrim     20,     0 Apr 29 10:35 ttyp0

   With my MESSAGES ON (mesg y) I can receive TALK(1) requests, use the 
   UNIX WRITE(1) command and other commands that allow users to talk
   to one another.  In IRC this would also allow me to get IRC /SUMMON
   messages.  To set up the "IRCD" program to work with /SUMMON type
   the following:  (using ROOT or an account that has access to '/dev').

       % chgrp tty ircd
       % chmod 6111 ircd 

   The above commands read: "Give IRCD access to GROUP tty (which is /dev)
   and then when ANYONE runs the IRCD allow SETUID and SETGID priviliges
   so that they can use the /SUMMON command.
 
